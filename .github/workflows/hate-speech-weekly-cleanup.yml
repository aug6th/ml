name: hate-speech-weekly-cleanup

on:
  # schedule:
  #   - cron: '0 4 * * 0'  # Every Sunday at 4 AM
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Cleanup old raw/clean/classified (keep last 7 days)
        run: |
          set -eux

          RETENTION_DAYS=7

          if [ -d "out/datalake/raw/dcinside" ]; then
            find out/datalake/raw/dcinside -maxdepth 1 -mindepth 1 -type d -mtime +$RETENTION_DAYS -print -exec rm -rf {} +
          fi

          if [ -d "out/datalake/clean/dcinside" ]; then
            find out/datalake/clean/dcinside -maxdepth 2 -type d -name 'dt=*' -mtime +$RETENTION_DAYS -print -exec rm -rf {} +
          fi

          if [ -d "out/datalake/classified/hate_speech/model=kcelectra" ]; then
            find out/datalake/classified/hate_speech/model=kcelectra -maxdepth 1 -mindepth 1 -type d -mtime +$RETENTION_DAYS -print -exec rm -rf {} +
          fi
